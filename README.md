# Преобразовние звука в цифры

## Запустить:

```bash
python evaluation.py numbers/test-example.csv out.csv
```
В качестве аргументов принимает input_path и output_path. Если второй аргумент не указан, вывод сохраняется в out.csv.

## Обучить:
```bash
python train_gender.py
python train_recognition.py
```

Предварительно надо прогнать csv с цифрами через нормализатор, чтобы получить train_norm.csv.  
Лучше начать учить только на одном спикере и добавить второго позже.
Шутка или нет, но официальный туторал pytorch делает обучает похожую сеть тоже на одном батче, чтобы можно было процессить предложения разной длины. 
Тут это не использовалось, но и gains от большого батча на CPU будут только на последних эпохах обучения, когда надо бы как-то усреднять градиенты. 
Так что обучение происходит на batch_size==1.

Модели достаточно компактные, поэтому чекпоинты лежат в папке states.

## Как работает

За распознавание голоса отвечает Seq2Seq GRU с Attention. 
На вход принимает спектрограммы. 
Если спектрограмма короче 512 фреймов, ей добавляется Padding.
Параметры сети следующие: 

Encoder:  
3-слойный GRU с hidden_size 256  
Decoder:  
3-слойный GRU с hidden size 256, который смотрит attention-ом на выходы с GRU. 
На вход подаётся последний hidden_dim каждого слоя GRU.

Пол классифицирует компактная свёрточная сеть с 1D свёртками по спектрограмме.
На вход подаётся более короткая спектрограмма. 
Всё, что длиннее 128 фреймов, обрезается.

В задании не требовалось определить пол. 
Совершенно очевидно что с одним полом модель будет работать лучше, а обучаться быстрее и стабильнее. 
Но нет, это не было использовано в решении. За исключением того что модель изначально обучалась на мужском голосе.
Поэтому она и лучше будет работать на нём.

## Ограничения
1. Работает только со цифрами от 1 до 999999, включая концы.
2. На вход принимаются спектрограммы строго короче 512 и длиннее 128 фреймов. Вся обучающая выборка попадает в этот диапазон.
3. Работает только с цифрами в инфинитивной форме. "Первый", "шестым" и т.д. не будут определены верно.
4. Цифры должны быть только на Русском языке

## TODO:
1. Дообучить ещё несколько эпох.
2. Поменять CrossEntropyLoss на CTCLoss